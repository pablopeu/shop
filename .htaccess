# Security: Block access to sensitive files and directories

# Block access to composer files
<FilesMatch "^composer\.(json|lock)$">
    Require all denied
</FilesMatch>

# Block access to package manager files
<FilesMatch "^package(-lock)?\.json$">
    Require all denied
</FilesMatch>

# Block access to .env files
<FilesMatch "^\.env">
    Require all denied
</FilesMatch>

# Block access to log files
<FilesMatch "\.(log|logs)$">
    Require all denied
</FilesMatch>

# Block access to backup files
<FilesMatch "\.(bak|backup|old|orig|save|swp|tmp)$">
    Require all denied
</FilesMatch>

# Block access to SQL files
<FilesMatch "\.sql$">
    Require all denied
</FilesMatch>

# Block access to git files
<FilesMatch "^\.git">
    Require all denied
</FilesMatch>

# Block access to .htaccess itself
<Files ".htaccess">
    Require all denied
</Files>

# Block access to all other hidden files (starting with .)
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

# Prevent directory listing
Options -Indexes

# Protect specific directories from direct access
RewriteEngine On

# Block direct access to config directory
RewriteCond %{REQUEST_URI} ^/shop/config/ [NC]
RewriteRule ^ - [F,L]

# Block direct access to data directory
RewriteCond %{REQUEST_URI} ^/shop/data/ [NC]
RewriteRule ^ - [F,L]

# Block direct access to includes directory
RewriteCond %{REQUEST_URI} ^/shop/includes/ [NC]
RewriteRule ^ - [F,L]

# Block direct access to mcp-server directory
RewriteCond %{REQUEST_URI} ^/shop/mcp-server/ [NC]
RewriteRule ^ - [F,L]

# Block direct access to vendor directory
RewriteCond %{REQUEST_URI} ^/shop/vendor/ [NC]
RewriteRule ^ - [F,L]

# Block direct access to node_modules directory
RewriteCond %{REQUEST_URI} ^/shop/node_modules/ [NC]
RewriteRule ^ - [F,L]

# Security headers (if mod_headers is available, otherwise ignored)
<IfModule mod_headers.c>
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>
