================================================================================
üö® PASOS URGENTES - EJECUTAR AHORA
================================================================================

PROBLEMA: Los webhooks est√°n siendo rechazados por validaci√≥n de firma inv√°lida
SOLUCI√ìN: Cambiar validaci√≥n a IP (m√°s confiable) y reprocesar pagos pendientes

================================================================================
PASO 1: SUBIR 3 ARCHIVOS VIA FTP
================================================================================

Archivos a subir a la ra√≠z de /shop/:

1. webhook.php              (corrige formato de webhooks)
2. reprocesar-pago.php      (clave simplificada)
3. config/payment.json      (validaci√≥n IP en vez de firma)

IMPORTANTE: El archivo config/payment.json debe tener este contenido:

{
  "mercadopago": {
    "mode": "production",
    "webhook_security": {
      "validate_signature": false,
      "validate_timestamp": false,
      "validate_ip": true,
      "max_timestamp_age_minutes": 5
    }
  },
  "presencial": {
    "enabled": true,
    "description": "Pago en efectivo al momento del retiro o entrega"
  }
}

================================================================================
PASO 2: REPROCESAR PRIMER PAGO
================================================================================

Abrir en el navegador:

https://peu.net/shop/reprocesar-pago.php?payment_id=132973453083&key=peu2024secure

Verificar que muestra:
‚úÖ Pago encontrado en MercadoPago
‚úÖ Orden actualizada a: cobrada
‚úÖ Email enviado
‚úÖ Notificaci√≥n de Telegram enviada

================================================================================
PASO 3: REPROCESAR SEGUNDO PAGO
================================================================================

Abrir en el navegador:

https://peu.net/shop/reprocesar-pago.php?payment_id=132891215537&key=peu2024secure

Verificar que muestra:
‚úÖ Pago encontrado en MercadoPago
‚úÖ Orden actualizada a: cobrada
‚úÖ Email enviado
‚úÖ Notificaci√≥n de Telegram enviada

================================================================================
VERIFICACI√ìN FINAL
================================================================================

1. Ir a: https://peu.net/shop/admin/ventas.php

2. Verificar que las 2 √≥rdenes ahora est√°n en estado "Cobrada" (verde):
   - order-6914e22098d65-8f4a3193 (simon@peu.net)
   - order-6914ef20f0f9d-1637d7cc (sdfg@sdf.com)

3. Ejecutar verificaci√≥n de webhooks:
   https://peu.net/shop/verificar-webhook.php?secret=peu2024secure

   Deber√≠a mostrar:
   - Validaci√≥n de IP: ‚úÖ Habilitada
   - Validaci√≥n de Firma: ‚ùå Deshabilitada
   - √ìrdenes pendientes: 0

================================================================================
¬øQU√â PASA DESPU√âS?
================================================================================

‚úÖ Los pr√≥ximos webhooks SE PROCESAR√ÅN CORRECTAMENTE
‚úÖ Las compras se marcar√°n como "cobrada" AUTOM√ÅTICAMENTE
‚úÖ Los clientes recibir√°n emails de confirmaci√≥n
‚úÖ Vos recibir√°s notificaciones por Telegram
‚úÖ El stock se reducir√° autom√°ticamente

Todo funcionar√° sin intervenci√≥n manual.

================================================================================
SI ALGO SALE MAL
================================================================================

1. Verificar que los 3 archivos se subieron correctamente
2. Verificar que config/payment.json tiene validate_ip: true
3. Revisar mp_debug.log (descargarlo via FTP)
4. Ejecutar verificar-webhook.php para diagn√≥stico

================================================================================

Tiempo estimado total: 5 minutos

================================================================================
